<!DOCTYPE html>
<html>
<head>
	<title>Meyda</title>
	<script type="text/javascript" src="main.js"></script>
	<meta charset="UTF-8">
</head>
<body>
	<div class="container">
		<div class="col-xs-12">
			<div class="page-header">
				<h1>Meyda</h1>
			</div>
			<audio src="test.mp3" id="tune" controls></audio>
			<p>Meyda is a feature extractor for the web audio API</p>
			<div id="feedback"></div>
		</div>
	</div>
	<script>
		var tune = document.getElementById('tune');
		tune.oncanplaythrough = function (e) {
			console.log("audio loaded");
			init();
			tune.play();
		}

		// callback for mic position
		function init() {
			// polyfill
			window.AudioContext = window.AudioContext || window.webkitAudioContext;
			var context = new AudioContext();

			// instantiate new medya
			var m = new Meyda(context,function(d){
				// update view in callback
				ractive.set({rms:d});
				console.log("output:", d);
			},"rms");

			// create audionode from mic
			window.source = context.createMediaElementSource( tune );

			// connect mic to medya
			source.connect( m );
		}
	</script>
</body>
</html>
